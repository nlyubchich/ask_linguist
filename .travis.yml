sudo: required
dist: trusty
language: node_js
python:
  - "3.5"
node_js:
  - "5.8"

services:
  - redis-server
  - postgresql

env:
  APP_SETTINGS: 'project.config.VaggaTestingConfig'
  SECRET_KEY: 'really secret'
  CSRF_SECRET: 'really secret'

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      # nodejs >v4 compiler requirements
      - g++-4.8

before_install:
  - export CHROME_BIN=/usr/bin/google-chrome
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - sudo apt-get update
  - sudo apt-get install -y libappindicator1 fonts-liberation
  - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
  - sudo dpkg -i google-chrome*.deb
  - sudo apt-get -y install python3-pip python3-dev
  - python -V
  - pip -V

install:
  - sudo pip install -r requirements.txt
  - sudo pip install flake8
  - npm install

before_script:
  - psql -c 'create database travis_ci_test;' -U postgres

script:
  - flake8 project/
  - npm run lint
  - python -m unittest project.tests.functional
